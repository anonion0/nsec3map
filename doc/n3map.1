.TH N3MAP 1 "2011-12-05" "n3map v.0.3"
.SH NAME
n3map \- Enumerate DNSSEC-enabled DNS zones 
.SH SYNOPSIS
.B n3map 
[options...] [-o file] [nameserver[:port]]... zone
.SH DESCRIPTION
Enumerate DNSSEC-enabled DNS zones that use either NSEC or NSEC3 records.
.SS Enumeration Options
.TP 
\fB\-a\fR, \fB\-\-auto\fR
Automatically detect whether the zone uses NSEC or NSEC3 records (default).

.TP 
\fB\-3\fR, \fB\-\-nsec3\fR
Use NSEC3 Enumeration.
.TP 
\fB\-n\fR, \fB\-\-nsec\fR
Use NSEC Enumeration.
.TP 
\fB\-o\fR, \fB\-\-output\fR=\fIFILE\fR
Write the received records to FILE. If FILE is -, the records are written to
standard output.
.TP 
\fB\-i\fR, \fB\-\-input\fR=\fIFILE\fR
Read a list of records from FILE and continue the enumeration. Such a file was
typically generated by the \fB\-\-output\fR option. 
In NSEC3 mode, the label counter value is also restored from FILE if
present (see the \fI\-\-label-counter\fR option).
.TP 
\fB\-c\fR, \fB\-\-continue\fR=\fIFILE\fR
Same as --input FILE --output FILE, but will preserve FILE as a backup file
until the enumeration is finished. Will create FILE if it does not exist yet.

Note that the original input file is regenerated which means that any additional
comments you may have made in FILE will be lost.

.SS NSEC Options
.TP 
\fB\-m\fR, \fB\-\-query-mode\fR=\fIMODE\fR
Change the NSEC query mode/strategy. MODE may be one of the following:
.IP 
\fIA\fR:
In this mode, only A queries are used. This mode is quite reliable, however, it
may require a lot of additional queries in some situations.

Since the direct querying of NSEC records is not needed for normal operations,
some nameservers do not allow it all. In those cases, this mode can be used to
circumvent that restriction. For the same reason enumeration attempts using
this only A queries may also appear slightly less obvious (especially when used
together with --ldh).
.IP 
\fINSEC\fR:
This mode only uses NSEC queries. It uses only a minimum amount of queries. The
downside is that this mode cannot be used on zones with subzones wich are served
by the same nameserver since this would lead to an endless loop. If this
situation is detected the enumeration will be aborted.
.IP 
\fImixed\fR:
This mode is the same as \fINSEC\fR mode, however, it may use A queries to step
over subzones. It uses less queries than the A mode and is currently the most
reliable NSEC query mode. By default, this mode is used.

.TP 
\fB\-M\fR, \fB\-\-mixed\fR
Same as --query-mode=mixed.
.TP 
\fB\-A\fR
Same as --query-mode=A.
.TP 
\fB\-N\fR
Same as --query-mode=NSEC.
.TP 
\fB\-b\fR, \fB\-\-binary\fR
Use all possible binary values as domain names in queries (default). 
.TP
.B " "
The DNS protocol allows any byte value in query names. However,
queries containing non-printable characters are quite unusual and may easily be
detected as an anomaly. See also the \fI\-\-ldh\fR option.
.TP 
\fB\-l\fR, \fB\-\-ldh\fR
Use only lowercase ASCII characters, digits and the hyphen (-) in query names
(known as the LDH rule).
.TP
.B " "
Using this option makes enumeration look less suspicious. The drawback is that
it may step over (miss) domain names that use other characters.
This option has no effect if the query mode is \fINSEC\fR (see the
\fI\-\-query-mode\fR option for details).
.TP 
\fB\-s\fR, \fB\-\-start\fR=\fINAME\fR
Instead of walking through the zone from the beginning, start at the domain NAME.
NAME is interpreted relative to the zone name. 
.TP
.B " "
Note that in \fINSEC\fR and \fImixed\fR query modes, the NAME has to actually
exist in the zone. Otherwise it can be an arbitrary domain name. See also the
\fI\-\-query-mode\fR option.
.TP 
\fB\-e\fR, \fB\-\-end\fR=\fINAME\fR
End as soon as enumeration reaches the domain NAME. NAME is interpreted relative
to the zone name. The NAME may be an arbitrary domain name that does not need to
actually exist in the zone.

.SS NSEC3 Options
.TP
\fB\-f\fR, \fB\-\-aggressive\fR=\fIN\fR
send up to N queries in parallel. This may speed up the enumeration
significantly if the DNS server's round-trip time is high. However, it will also
cause n3map to make more queries than usual because it cannot completely avoid
queries which resolve to the same NSEC3 records. Use with caution.
.TP
\fB\-\-ignore-overlapping\fR
Do not abort enumeration if overlapping NSEC3 records are received. 
.TP
.B " "
Normally, overlapping NSEC3 records are a sign that the zone has changed during
the enumeration process. If you specify this option you may end up with a
NSEC3 chain that is not entirely correct when the enumeration ends (i.e., some
records may be missing and others may have been deleted from the zone since).
.TP 
.B " "
Note however that this option is especially useful when enumerating very large zones
which change frequently (during enumeration) and whose enumeration would thus
likely fail.
.TP 
\fB\-p\fR, \fB\-\-predict\fR
try to predict the size of the zone based on the records already received.
Note that this option might slow down the enumeration process (experimental)
.TP 
\fB\-\-processes\fR=\fIN\fR
Specifies the number of NSEC3 hash calculation processes to use.
By default the number is the number of CPUs - 1 (minimum 1).
.TP
\fB\-\-hashlimit\fR=\fIN[K|M|G|T]\fR
Stop the enumeration after checking N hashes, even if it is not finished.
Use this option to prevent n3map from wasting cpu cycles in a (possibly futile)
attempt to extract the last few records of a zone.
Default = 0 (unlimited).

.SS Advanced NSEC3 Options
These options are for advanced users and are rarely needed. They should be used
with caution.
.TP 
\fB\-\-label-counter\fR=\fIN\fR
Set the initial label counter to N. The label counter is used to generate the
next possible query name in NSEC3 mode. When continuing an enumeration, it 
is important to set the initial label counter to the last value tried
before. Otherwise, it may take a long time to retry all the values which have
already been tried in the previous run. However, you normally don't need to
specify the label counter since it is automatically restored from the input file
when present (see the \fI\-\-input\fR option).

.TP 
\fB\-\-queue-element-size\fR=\fIN\fR
Set the number of (domainname, hash) pairs in a single queue element. Setting this
option on a low value increases synchronisation overhead. Setting it too high may
result in a long delay before the enumeration is started, especially on older
systems.
.TP 
\fB\-\-no-openssl\fR
do not use OpenSSL for hashing (slower)

.SS General Options
.TP
\fB\-q\fR, \fB\-\-quiet\fR
do not display progress information during enumeration
.TP
\fB\-\-limit-rate\fR=\fIrate{/s|/m|/h}\fR
Limit the maximum query rate. The Rate may be any positive floating-point number
followed by a mandatory `/s', `/m' or `/h' suffix.
.TP
\fB\-\-timeout\fR=\fITIME\fR
Specifies how long to wait for a response from a DNS server, in milliseconds.
.TP
\fB\-\-max-retries\fR=\fIN\fR
Specifies how many times to repeat a query if the first attempt has failed due
to a response timeout.
.TP
\fB\-\-max-errors\fR=\fIN\fR
Specifies how many consecutive errors/wrongful responses  a server may return
before it is removed from the nameserver list.
.TP
\fB\-\-detection-attempts\fR=\fIN\fR
Specifies how many times to try zone type (NSEC/NSEC3) detection. N=0 specifies
an unlimited number of attempts.
.TP
.B \-\-omit-soa-check
Do not check the SOA record of the zone before starting the enumeration. This
option may be used if you wish to perform no unnecessary queries. However, it
should be used with caution, especially when enumerating an NSEC zone.
.TP 
.B \-\-omit-dnskey-check
Do not check the DNSKEY record of the zone before starting the enumeration. This
option may be used if you wish to perform no unnecessary queries. However, it
should be used with caution, as it may lead to problems when trying to
enumerate a zone that is not actually DNSSEC-enabled.
.TP 
\fB\-h\fR, \fB\-\-help\fR
Display a help message on standard output and exit successfully.
.TP
.B \-\-version
Display version information on standard output and exit successfully.
.TP 
\fB\-v\fR, \fB\-\-verbose\fR
increase verbosity level (use multiple times for greater effect) 
.TP 
\fB\-\-color\fR=\fIWHEN\fR
colorize output; WHEN can be 'auto' (default), 'always' or 'never'.
.TP 
\fB\-4\fR
Use IPv4 only.
.TP 
\fB\-6\fR
Use IPv6 only.

.SH EXIT STATUS
.TP
0
if OK
.TP
1
if an error occurred
.TP
2
if a serious error occurred (e.g. error parsing the command line arguments)

.SH EXAMPLES
.PP
A simple example:
.PP
.RS
$ n3map -p ns1.example.com. example.com.
.RE
.PP
This will enumerate the zone example.com (if it is DNSSEC-enabled) using the
nameserver ns1.example.com. It will automatically determine whether the zone
uses NSEC or NSEC3 records. We also used the \fI-p\fR option so we can see the
progress of the enumeration.
If we want to see what happens in more detail, we can increase the verbosity
using the \fI-v\fR option:
.PP
.RS
$ n3map -pv ns1.example.com. example.com.
.RE
.PP
Next, we want to save all received NSEC or NSEC3 records to a file (which is
what you usually want). The file will be called `records':
.PP
.RS
.nf
$ n3map -pv ns1.example.com. example.com. -o records
.fi
.RE
.PP
You can always interrupt the enumeration by sending the SIGINT signal to the
main process (usually this is achieved by pressing CTRl-C).
If you have interrupted a session and want to continue where it stopped later,
you may used the \fI-c\fR option:
.PP
.RS
.nf
$ n3map -pv ns1.example.com. example.com. -o records
[interrupt by pressing CTRL-C]
$ n3map -pv ns1.example.com. example.com. -c records
.fi
.RE
.PP
The next example is a bit more sophisticated:
.PP
.RS
.nf
$ n3map ns1.example.com. ns2.example.com:5353  example.com. -pv3o records.nsec3  --limit-rate 10/s
.fi
.RE
.PP
This command forces NSEC3 enumeration (the \fI-3\fR option) and limits the query
rate to a maximum of 10 queries / second. Note that we also specified a second
nameserver using a different port (5353).

.SH "SEE ALSO"
\fBn3map-nsec3-lookup\fR(1),
\fBn3map-hashcatify\fR(1),
\fBn3map-johnify\fR(1),
\fBdig(1)\fR

.SH BUGS
.PP
lot's of em. 
.PP
It may use a huge amount of memory when enumerating large zones. 
.PP
Reading large lists of records is slow.

